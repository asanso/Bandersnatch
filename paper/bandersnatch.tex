\documentclass{amsart}

\usepackage{hyperref}
\usepackage[capitalize]{cleveref}
\usepackage{tikz}
\usepackage[all]{xy}
\usepackage[foot]{amsaddr}
\usepackage{xcolor}

%% \newcommand{\AS}[1]{\color{red}#1\color{black}}
\newcommand{\SM}[1]{\color{blue}#1\color{black}}

\newcommand{\Q}{\ensuremath{\mathbb Q}}
\newcommand{\Z}{\ensuremath{\mathbb Z}}
\newcommand{\Fp}{\ensuremath{\mathbb F_p}}
\newcommand{\End}{\ensuremath{\text{End}}}

\begin{document}
\title[Bandersnatch]{Bandersnatch: a fast elliptic curve built over the BLS12-381 scalar field.}
\author{Simon Masson}
\address{Heliax}
\author{Antonio Sanso}
\address{Ethereum Foundation and Ruhr Universit{\"a}t Bochum}


\maketitle
\medskip
\begin{abstract}
 In this short note we  introduce Bandersnatch a new elliptic curve built over the BLS12-381 \cite{bls12381} scalar field. The curve is similar to Jubjub \cite{jubjub} but is equipped with the GLV endomorphism \cite{C:GalLamVan01} hence it has faster scalar multiplication.
 \end{abstract}

\section{Introduction}
%BLS12-381
BLS12-381 is a pairing friendly curve created by Sean Bowe in 2017
\cite{bls12381}. Currently BLS12-381 is universally used for digital
signatures and zero-knowledge proofs by many project orbiting in the
blockchin universe: Zcash, Ethereum 2.0, Skale, Algorand, Dfinity,
Chia, and more.
%jubjub
The ZCash team also introduced a new curve built over the BLS12-381
scalar field Jubjub  \cite{jubjub}: a twisted Edwards curve that can
be made efficient inside of the zk-SNARK circuit.
%our goal
In order for some cryptographic application to scale, it is needed to
have a curve like Jubjub but with faster scalar multiplication. One
efficient way to speed scalar multiplication up is to employ the
celebrated GLV endomorphism \cite{C:GalLamVan01} (also used
by the “Bitcoin curve” - secp256k1).
This technique was until few months ago protected by a US Patent that
is now expired and freely usable.
We performed an exhaustive search of curves where the GLV endomorphism
could be used over the BLS12-381 scalar field using the Complex
Multiplication (CM) method of generating an elliptic curve.

\SM{TODO:more details on GLV? Why not possible on Jubjub, etc.}

\section{Small discriminant curves}

The GLV method~\cite{C:GalLamVan01} is a well known trick for accelerating the
scalar multiplication over particular curve. In a nutshell, it applies
to elliptic curves endowed with an efficiently computable endomorphism
$\psi$.
Generally, the $j=0$ and $1728$ curves are used because non-trivial
automorphisms fit very well, but it also applies for other curves, as
we will see in this section.

% notations
Let $E$ be an elliptic curve defined over $\Fp$. The Frobenius
map $(x,y)\mapsto (x^p,y^p)$ is an endomorphism of degree $p$ of the
curve and we denote $\xi(X) = X^2 - tX + p$ its minimal polynomial.
The coefficient $t$ is called the trace of the curve and is closely
related to the curve order: $\#E(\Fp) = p+1-t$.
In this work, we are looking for ordinary elliptic curves
corresponding to the case where $\End(E)$ is an order of the imaginary
quadratic field $\Q(\sqrt{t^2-4p})$.
We denote $-D$ to be the discriminant of $\End(E)$, and $\{\text{Id},\psi\}$
a basis of the endomorphism ring. The fundamental discriminant
corresponds to the discriminant of the maximal order containing $\End(E)$.
This way, $\psi$ is a degree $\frac{D+1}4$ or $D/4$ depending on the
value of $p$ modulo $4$, and $\psi$ can be defined using polynomials
of degree $O(D)$ thanks to the Vélu's formulas~\cite{velu71}.
Thus, $\psi$ is efficiently computable only for curves of small discriminant.
For example, for $p\equiv 1$ mod $3$, elliptic curves of $j$-invariant $0$
have discriminant $-3$ corresponding to $\psi(x,y) = (\beta x, y)$
where $\beta$ is an order $3$ element of $\Fp$.
In this particular case, the endomorphism $\psi$ can be evaluated
using only one mulltiplication in $\Fp$.

In this work, we look for curves of small discriminant in order to
find a curve defined over the BLS12-381 scalar field where the GLV
method applies. Moreover, we are looking for secure curves in the
sense that the curve and its twist are not threaten by subgroup
attacks, meaning that the order of the curve and its quadratic twist
has a large prime factor.

As the endomorphism cost is closely related to the discriminant, we
restrict to $-D \geq -388$. Moreover, isogenous curve have the same
order and we can restrict on fundamental discriminants.

We compute an exhaustive search among all the possible discriminant
($-388 \leq -D \leq -3$) in
\href{https://github.com/asanso/Bandersnatch/blob/main/code/small-disc-curves.py}{this
  file}, and we finally obtain an interesting curve for $-D = -2 \cdot 4$.
It means that the curve has an endomorphism $\psi$ satisfying $\psi^2
= [-2]$.
In the next section, we present this curve and several properties
related to the  GLV scalar multiplication in this case.

\SM{TODO: explain our algorithm for finding curves, subgroup and twist
  security.}

\SM{TODO: not defined: quadratic twist, isogenous curves, fundamental
  discriminant.}

\SM{TODO: find the bib of all the references}

\section{Bandersnatch} 

\SM{TODO: add parameters for weierstrass so that people can use sagemath
  easily to create the curve and see its order.}

The Bandersnatch curve can be represented in the Weierstrass model
using the following parameters:
\begin{verbatim}
p=52435875175126190479447740508185965837690552500527637822603658699938581184513
a=20856223409030707214153620029242927260100058688354534505372746703669794261922
b=4118395616383396936705917269457205707251888519744679123386326773690169742488
E=EllipticCurve(GF(p), [a,b])
\end{verbatim}
This curve has discriminant $-8$, and $j$-invariant $8000$. It means
that $8000$ is a root of the Hilbert class polynomial $H_{-8}$.
The bandersnatch curve order is $2^2\cdot r$ for a $253$-bit long
prime $r$.
% 13108968793781547619861935127046491459309155893440570251786403306729687672801
This lets us represent our curve in Twisted Edwards coordinates.
In this model, the Bandersnatch curve can be defined by the equation
$$E_\text{TE}:-5x^2+y^2 = 1 + \frac{138827208126141220649022263972958607803}{171449701953573178309673572579671231137}x^2y^2$$ 
The quadratic twist of $E_\text{TE}$ has order $2^7 \cdot 3^3 \cdot r'$ another
prime $r'$ of $244$ bits
%15172417585395309745210573063711216967055694857434315578142854216712503379
and so our curve satisfies twist security after a quick cofactor
check.
The different attacks on the Bandersnatch curve lead to $125.75$ bits
of security.

From that, we exhibit the degree $2$ endomorphism in Twisted Edwards
coordinates:
$$\psi(x,y,z) = (xa_1(y+a_2z)(y+a_3z), b_1(y+b_2z)(y+b_3z)yz^2,
(y+c_1z)(y+c_2z)yz^2) \qquad a_i, b_i, c_i \in \Fp.$$
This map can be computed in 17 multiplications and 6 additions modulo $p$.

A twisted Edwards curve is always birationally equivalent to a
Montgomery curve.
While the Twisted Edwards model fits better for $\mathbb F_p$ circuit
arithmetic, we provide here the Montgomery version because the scalar
multiplication is more efficient in this context.
$$E_\text{M}: By^2 = x^3 + Ax^2 + x$$
\begin{align*}
  B &= \text{\small{43133420749626800644911662702407007968989685651477499770299667990488723916667}}\\
  A &= \text{\small{29978822694968839326280996386011761570173833766074948509196803838190355340952}}.
\end{align*}


\section{Comparison}

\SM{TODO: talk about $a=-1$ vs $a=-5$, and give more precise complexity
analysis and benchmarks.}

%### Scalar multiplication improvement
From the efficient endomorphism $\psi$, it is easy to apply the GLV method and improve the scalar multiplication cost:
Roughly, a scalar multiplication $[n]P$ cost $(\log n) \text{Dbl} + (\log n/2) \text{Add}$.
Using the GLV endomorphism, we can compute $[n]P$ using $(\log n/2 )\text{Dbl} + (3\log n/8) \text{Add}$, plus few precomputations.

We performed `python` benchmarks between the double-and-add algorithm and the GLV method applied in the case of our curve, and the GLV version is about 30\% faster 
\footnote{Source code \url{https://github.com/asanso/Bandersnatch/}.}

\bigskip
\paragraph*{\textbf{Acknowledgments.}} we would like to thank Luca De Feo, Justin Drake, Dankrad Feist, Daira Hopwood and Zhenfei Zhang for fruitful discussions.

\bibliography{bandersnatch,cryptobib/abbrev3,cryptobib/crypto}
\bibliographystyle{unsrt}
\end{document}
